$ forge coverage --ir-minimum --report summary | tee coverage-summary.txt
Warning! "--ir-minimum" flag enables viaIR with minimum optimization, which can result in inaccurate source mappings.
Only use this flag as a workaround if you are experiencing "stack too deep" errors.
Note that "viaIR" is only available in Solidity 0.8.13 and above.
See more: https://github.com/foundry-rs/foundry/issues/3357
Compiling 69 files with Solc 0.8.28
Solc 0.8.28 finished in 20.08s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 1 test for test/IdeationMarketDiamondTest.t.sol:IdeationMarketInvariantTest
[PASS] invariant_ProceedsSumEqualsDiamondBalance() (runs: 256, calls: 128000, reverts: 111917)
Suite result: ok. 1 passed; 0 failed; 0 skipped; finished in 71.23s (71.10s CPU time)

Ran 223 tests for test/IdeationMarketDiamondTest.t.sol:IdeationMarketDiamondTest
[PASS] invariant_RecordedProceedsEqualsDiamondBalance() (runs: 256, calls: 128000, reverts: 105340)
[PASS] testAdminCallDuringTransfer_DoesNotBypassOnlyOwner_ERC721() (gas: 1269779)
[PASS] testBatchAddWhitelistedCollectionWithZeroReverts() (gas: 101723)
[PASS] testBuyNonexistentListingIdReverts() (gas: 40664)
[PASS] testBuyerWhitelistAddDuplicatesIdempotent() (gas: 428556)
[PASS] testBuyerWhitelistAddRemove() (gas: 1000577)
[PASS] testBuyerWhitelistAddRemoveWhenDisabledAllowed() (gas: 408856)
[PASS] testBuyerWhitelistRemoveEmptyCalldataReverts() (gas: 410934)
[PASS] testBuyerWhitelistRemoveNonWhitelistedNoRevert() (gas: 428602)
[PASS] testBuyerWhitelistRemoveNonexistentListingReverts() (gas: 32687)
[PASS] testBuyerWhitelistRemoveUnauthorizedReverts() (gas: 425500)
[PASS] testBuyerWhitelist_AddRemove_ByERC721OperatorForAll() (gas: 489501)
[PASS] testBuyerWhitelist_AddRemove_ByERC721TokenApprovedOperator() (gas: 461407)
[PASS] testCancelAfterERC721BurnByOperatorForAll() (gas: 364496)
[PASS] testCancelAfterERC721BurnByOwner() (gas: 337894)
[PASS] testCancelERC1155ListingByOperator() (gas: 370456)
[PASS] testCancelERC721ByOperatorForAll() (gas: 337831)
[PASS] testCancelListing() (gas: 332696)
[PASS] testCancelListingAfterERC1155Burn_ByContractOwner() (gas: 985500)
[PASS] testCancelListingAfterERC721BurnByOperatorForAll() (gas: 374021)
[PASS] testCancelListingAfterERC721BurnByOwner() (gas: 344561)
[PASS] testCancelListingAfterERC721BurnBySeller() (gas: 346334)
[PASS] testCancelListingAfterERC721Burn_ByContractOwner() (gas: 1108335)
[PASS] testCancelListingByERC721ApprovedOperator() (gas: 335171)
[PASS] testCancelListing_BurnedERC1155_BySeller() (gas: 348199)
[PASS] testCancelListing_UnauthorizedThirdParty_ERC1155_Reverts() (gas: 389677)
[PASS] testCancelListing_UnauthorizedThirdParty_ERC721_Reverts() (gas: 378304)
[PASS] testCancelNonexistentListingReverts() (gas: 26634)
[PASS] testCleanListing721() (gas: 340894)
[PASS] testCleanListingAfterDeWhitelistingCancels() (gas: 323304)
[PASS] testCleanListingAfterERC1155BurnAllByThirdUser() (gas: 362199)
[PASS] testCleanListingAfterERC721BurnByThirdUser() (gas: 348537)
[PASS] testCleanListingCancelsAfterERC1155Burn() (gas: 1010498)
[PASS] testCleanListingCancelsAfterERC721Burn() (gas: 1114219)
[PASS] testCleanListingCancelsAfterOwnerChangedOffMarket() (gas: 345139)
[PASS] testCleanListingERC1155() (gas: 332334)
[PASS] testCleanListingERC1155_BalanceDrift_AfterApprovalRevoked_Cleans() (gas: 375220)
[PASS] testCleanListingERC1155_BalanceDrift_ApprovalIntact_Cancels() (gas: 376736)
[PASS] testCleanListingERC1155_BalanceDrift_ApprovalIntact_Cancels_BurnVariant() (gas: 371868)
[PASS] testCleanListingERC721_OwnerChangedButApprovalIntact_Cancels() (gas: 347972)
[PASS] testCleanListingEmitsCancellationEvent() (gas: 330735)
[PASS] testCleanListing_BurnedERC721_Cancels() (gas: 324200)
[PASS] testCleanListing_WhileStillApproved_ERC1155_Reverts() (gas: 391190)
[PASS] testCleanListing_WhileStillApproved_ERC721_Reverts() (gas: 372230)
[PASS] testCollectionWhitelistAddAndRemove() (gas: 118521)
[PASS] testCollectionWhitelistBatchOperations() (gas: 182228)
[PASS] testCollectionWhitelistZeroAddressReverts() (gas: 26897)
[PASS] testCreateListingERC721() (gas: 409063)
[PASS] testCreateListingERC721Reverts() (gas: 376608)
[PASS] testCreateListingWhitelistWithZeroAddressReverts() (gas: 359932)
[PASS] testCreateListingWithNonNFTContracQt0tReverts() (gas: 219559)
[PASS] testCreateListingWithNonNFTContractQ9Reverts() (gas: 219416)
[PASS] testCreateListingWithoutApprovalReverts() (gas: 143187)
[PASS] testCreatePriceZeroWithoutSwapReverts() (gas: 162641)
[PASS] testCreateWithWhitelistDisabledNonEmptyListReverts() (gas: 342202)
[PASS] testCreateWithWhitelistEnabledEmptyArrayOK() (gas: 392310)
[PASS] testCreateWithWhitelistExactlyMaxBatchSucceeds() (gas: 9046221)
[PASS] testCreateWithWhitelistOverMaxBatchReverts() (gas: 1274673)
[PASS] testCreateWithZeroTokenAddressReverts() (gas: 31210)
[PASS] testDiamondCutAddZeroAddressReverts() (gas: 33494)
[PASS] testDiamondCutAuthAndUpgradeFlow() (gas: 421908)
[PASS] testDiamondCutReplaceZeroAddressReverts() (gas: 262899)
[PASS] testDiamondInitialization() (gas: 61139)
[PASS] testDiamondLoupeFacets() (gas: 131440)
[PASS] testDoubleCleanReverts() (gas: 319682)
[PASS] testDoubleSell_Prevented_ERC1155_FullFill_Strict() (gas: 2004066)
[PASS] testDoubleSell_Prevented_ERC721_Strict() (gas: 2109935)
[PASS] testERC1155BuyExactRemainingRemovesListing() (gas: 470424)
[PASS] testERC1155BuyerContractWithoutReceiverInterfaceReverts_Strict() (gas: 2208562)
[PASS] testERC1155BuyingMoreThanListedReverts() (gas: 401837)
[PASS] testERC1155CreateInsufficientBalanceReverts() (gas: 177853)
[PASS] testERC1155CreateUnauthorizedListerReverts() (gas: 187252)
[PASS] testERC1155CreateWithoutMarketplaceApprovalReverts() (gas: 155633)
[PASS] testERC1155HolderDifferentFromSellerHappyPath() (gas: 478756)
[PASS] testERC1155HolderZeroBalanceAtCreateRevertsWrongHolder() (gas: 125589)
[PASS] testERC1155MultiStepPartialsMaintainPriceProportions() (gas: 632727)
[PASS] testERC1155OperatorNotApprovedReverts_thenSucceedsAfterApproval() (gas: 465762)
[PASS] testERC1155OverRemainingAfterPartialReverts() (gas: 521131)
[PASS] testERC1155PartialBurnBelowListed_PurchaseRevertsThenClean() (gas: 388387)
[PASS] testERC1155PartialBuyDisabledReverts() (gas: 399041)
[PASS] testERC1155PartialBuyHappyPath() (gas: 529768)
[PASS] testERC1155PurchaseMarketplaceApprovalRevokedReverts() (gas: 415426)
[PASS] testERC1155PurchaseSellerBalanceDroppedReverts() (gas: 460623)
[PASS] testERC1155UpdateApprovalRevokedReverts() (gas: 375993)
[PASS] testERC1155UpdateBalanceTooLowReverts() (gas: 442100)
[PASS] testERC1155UpdateInvalidUnitPriceReverts() (gas: 393691)
[PASS] testERC1155UpdateUnauthorizedOperatorReverts() (gas: 413337)
[PASS] testERC1155ZeroQuantityPurchaseReverts() (gas: 389497)
[PASS] testERC1155_LiarToken_TransferReverts_RollsBackListing() (gas: 1115799)
[PASS] testERC1155_MultiListings_SameAndDifferentSellers_AppearInReverseIndex() (gas: 665998)
[PASS] testERC1155_PartialBuy_OverpayCreditsBuyer() (gas: 580577)
[PASS] testERC1155_PartialBuy_SecondBuyerWithStaleExpectedTermsReverts() (gas: 541296)
[PASS] testERC1155_PartialBuy_UnderpayReverts() (gas: 426233)
[PASS] testERC1155_ReverseIndex_LastDelete_ThenReAdd_NoGhosts() (gas: 808073)
[PASS] testERC1155_ReverseIndex_MiddleDelete_Compaction() (gas: 807884)
[PASS] testERC1155toERC1155Swap_BuyerIsOperatorForDesired() (gas: 1392979)
[PASS] testERC1155toERC1155Swap_Pure() (gas: 1321809)
[PASS] testERC1155toERC1155Swap_WithEth() (gas: 1410844)
[PASS] testERC2981RevertingRoyaltyRevertsPurchase() (gas: 1369743)
[PASS] testERC2981ZeroRoyalty() (gas: 1438672)
[PASS] testERC721BuyerContractWithoutReceiverInterfaceReverts_Strict() (gas: 2313538)
[PASS] testERC721CreateUnauthorizedListerReverts() (gas: 164167)
[PASS] testERC721OperatorListsAndPurchaseSucceeds_AfterFix() (gas: 1383574)
[PASS] testERC721PurchaseWithNonZero1155QuantityReverts() (gas: 380626)
[PASS] testERC721ReceiverSwallowsRevert_DoesNotMaskMarketplaceChecks() (gas: 638540)
[PASS] testERC721SetApprovalForAllCreateListing() (gas: 375443)
[PASS] testERC721UpdateApprovalRevokedReverts() (gas: 366607)
[PASS] testERC721_LiarToken_TransferReverts_RollsBackListing() (gas: 1156811)
[PASS] testEmitInnovationFeeUpdated() (gas: 52326)
[PASS] testEmitListingCanceled() (gas: 305956)
[PASS] testEmitListingCanceledDueToInvalidListing() (gas: 316971)
[PASS] testEmitListingCreated() (gas: 367636)
[PASS] testEmitListingPurchased() (gas: 394052)
[PASS] testEmitListingUpdated() (gas: 398779)
[PASS] testEmitProceedsWithdrawn() (gas: 429929)
[PASS] testEmitRoyaltyPaid() (gas: 1473476)
[PASS] testExcessPaymentCreditAndWithdraw() (gas: 491450)
[PASS] testExpectedDesiredFieldsMismatchReverts() (gas: 429793)
[PASS] testExpectedErc1155QuantityMismatchReverts() (gas: 399655)
[PASS] testExpectedPriceMismatchReverts() (gas: 408910)
[PASS] testFeeExactly100Percent_SucceedsSellerGetsZero() (gas: 406368)
[PASS] testFeeRoyaltyRounding_TinyPrices() (gas: 1890296)
[PASS] testGetProceedsNeverInteractedIsZero() (gas: 23056)
[PASS] testGetterNoActiveListingsReverts() (gas: 309145)
[PASS] testInnovationFeeUpdateSemantics() (gas: 678743)
[PASS] testInvalidNoSwapDesiredErc1155QuantityReverts() (gas: 163264)
[PASS] testInvalidNoSwapDesiredTokenIdReverts() (gas: 159743)
[PASS] testInvalidUnitPriceOnCreateReverts() (gas: 156550)
[PASS] testInvariant_ContractBalanceEqualsSumOfProceeds_AfterOps() (gas: 1755448)
[PASS] testIsBuyerWhitelistedInvalidListingIdReverts() (gas: 23909)
[PASS] testListingIdIncrements() (gas: 609793)
[PASS] testLoupeReflectsAddReplaceRemove() (gas: 417605)
[PASS] testLoupeSelectorsPerFacet() (gas: 328966)
[PASS] testNoOpUpdateKeepsValues() (gas: 414188)
[PASS] testOwnerCanCancelAnyListing() (gas: 311028)
[PASS] testOwnershipTransfer() (gas: 112239)
[PASS] testPartialBuyWithQuantityOneReverts() (gas: 179000)
[PASS] testPartialBuyWithSwapReverts() (gas: 180863)
[PASS] testPathologicalFeeCausesRevert() (gas: 397782)
[PASS] testPurchaseAfterCollectionDeWhitelistingStillSucceeds() (gas: 403822)
[PASS] testPurchaseFeeSnapshotOldFee() (gas: 407866)
[PASS] testPurchaseListingERC721() (gas: 432553)
[PASS] testPurchaseRevertsAfterERC721Burn() (gas: 399960)
[PASS] testPurchaseRevertsAfterWhitelistRemoval() (gas: 432524)
[PASS] testPurchaseRevertsIfApprovalRevokedBeforeBuy() (gas: 384288)
[PASS] testPurchaseRevertsIfOwnerChangedOffMarket() (gas: 406762)
[PASS] testPurchaseRevertsWhenBuyerIsSeller() (gas: 381660)
[PASS] testPurchaseRevertsWhenRoyaltyExceedsProceeds() (gas: 1527433)
[PASS] testPurchaseWithMaliciousERC1155Desired_Succeeds_NoReentrancy() (gas: 1289829)
[PASS] testPurchaseWithMaliciousERC1155Listed_Succeeds_NoReentrancy() (gas: 1095013)
[PASS] testPureSwap_AccidentalEthCreditedToBuyer() (gas: 2463962)
[PASS] testReceiverHooksThatSwallowReverts_ERC1155() (gas: 694375)
[PASS] testReceiverHooksThatSwallowReverts_ERC721() (gas: 662132)
[PASS] testReentrancyDuringERC1155Transfer() (gas: 1104023)
[PASS] testReentrancyDuringERC721Transfer() (gas: 1224462)
[PASS] testReentrancyOnWithdrawProceeds() (gas: 631267)
[PASS] testReentrancy_BuyerReceiver_ERC1155_Strict() (gas: 2657544)
[PASS] testReentrancy_BuyerReceiver_ERC721_Strict() (gas: 2708516)
[PASS] testRepurchaseAfterBuyReverts() (gas: 405001)
[PASS] testRoyaltyEdge_HighFeePlusRoyaltyExceedsProceeds() (gas: 1534307)
[PASS] testRoyaltyEqualsPostFeeProceedsBoundary() (gas: 1464402)
[PASS] testRoyaltyReceiverEqualsSeller() (gas: 1458384)
[PASS] testRoyaltyReceiverZeroAddress() (gas: 1463682)
[PASS] testSellerCancelAfterApprovalRevoked() (gas: 317325)
[PASS] testSetInnovationFeeEmitsEvent() (gas: 49197)
[PASS] testSetInnovationFeeOnlyOwner() (gas: 24804)
[PASS] testSupportsInterface() (gas: 62646)
[PASS] testSupportsInterfaceNegative() (gas: 23290)
[PASS] testSwap1155MissingHolderParamReverts() (gas: 419999)
[PASS] testSwapCleanupERC1155_RemainingBelowListed_Deleted() (gas: 1545353)
[PASS] testSwapCleanupERC1155_RemainingEqualsListed_NotDeleted() (gas: 1694243)
[PASS] testSwapDesiredTypeMismatchERC1155Reverts() (gas: 162817)
[PASS] testSwapDesiredTypeMismatchERC721Reverts() (gas: 167670)
[PASS] testSwapERC1155DesiredBalanceInsufficientReverts() (gas: 1515901)
[PASS] testSwapERC1155toERC1155_PureSwap_HappyPath() (gas: 2095832)
[PASS] testSwapERC1155toERC1155_WithEth_AndBuyerIsOperatorForDesired() (gas: 2173392)
[PASS] testSwapERC721BuyerNotOwnerOrOperatorReverts() (gas: 2481998)
[PASS] testSwapERC721DesiredNotApprovedReverts() (gas: 2482058)
[PASS] testSwapERC721ToERC1155_OperatorNoMarketApprovalReverts_ThenSucceeds() (gas: 612280)
[PASS] testSwapERC721ToERC721_WithCleanupOfObsoleteListing() (gas: 2502732)
[PASS] testSwapExpectedDesiredFieldsMismatchReverts() (gas: 1528497)
[PASS] testSwapWithEth_ERC721toERC1155_HappyPath() (gas: 2301406)
[PASS] testSwapWithEth_ERC721toERC721_HappyPath() (gas: 2480489)
[PASS] testSwapWithEth_OverpayCreditsBuyer() (gas: 2509361)
[PASS] testSwapWithSameNFTReverts() (gas: 163229)
[PASS] testSwap_ERC1155toERC1155_DesiredHolderNoMarketApprovalReverts_ThenSucceeds() (gas: 538562)
[PASS] testSwap_ERC1155toERC1155_HappyPath() (gas: 500658)
[PASS] testSwap_ERC1155toERC1155_PureSwap_BuyerIsOperatorForDesired() (gas: 2226375)
[PASS] testSwap_ERC1155toERC1155_WithEth() (gas: 2256035)
[PASS] testSwap_ERC1155toERC721_HappyPath() (gas: 1459461)
[PASS] testTogglePartialBuyEnabledWithoutPriceChange() (gas: 449139)
[PASS] testUnknownFunctionReverts() (gas: 15513)
[PASS] testUpdateAfterCollectionDeWhitelistingCancels() (gas: 329531)
[PASS] testUpdateDisableWhitelistThenOpenPurchase() (gas: 452548)
[PASS] testUpdateEnableWhitelistWithEmptyArrayOK() (gas: 423219)
[PASS] testUpdateFlipERC1155ToERC721Reverts() (gas: 407646)
[PASS] testUpdateFlipERC721ToERC1155Reverts() (gas: 369816)
[PASS] testUpdateInvalidNoSwapDesiredErc1155QuantityReverts() (gas: 375757)
[PASS] testUpdateInvalidNoSwapDesiredTokenIdReverts() (gas: 375272)
[PASS] testUpdateKeepsListingId() (gas: 512021)
[PASS] testUpdateListing() (gas: 504044)
[PASS] testUpdateListingWhitelistWithZeroAddressReverts() (gas: 394729)
[PASS] testUpdateNonexistentListingReverts() (gas: 30419)
[PASS] testUpdatePartialBuyWithSmallQuantityReverts() (gas: 414690)
[PASS] testUpdatePartialBuyWithSwapReverts() (gas: 420286)
[PASS] testUpdatePriceZeroWithoutSwapReverts() (gas: 374950)
[PASS] testUpdateSwapDesiredTypeMismatchERC1155Reverts() (gas: 377701)
[PASS] testUpdateSwapDesiredTypeMismatchERC721Reverts() (gas: 381082)
[PASS] testUpdateWhitelistDisabledWithAddressesReverts() (gas: 383902)
[PASS] testUpdateWhitelistExactlyMaxBatchSucceeds() (gas: 8812796)
[PASS] testUpdateWhitelistOverMaxBatchReverts() (gas: 1042288)
[PASS] testWhitelistDuplicatesOnCreateIdempotent() (gas: 448764)
[PASS] testWhitelistDuplicatesOnUpdateIdempotent() (gas: 478170)
[PASS] testWhitelistPreventsPurchase() (gas: 428631)
[PASS] testWhitelistScale_PurchaseUnaffectedByLargeList() (gas: 70041515)
[PASS] testWhitelist_BlocksSwap_ERC721toERC1155() (gas: 1456559)
[PASS] testWhitelist_BlocksSwap_ERC721toERC721() (gas: 2485407)
[PASS] testWhitelistedBuyerPurchaseSuccess() (gas: 438899)
[PASS] testWithdrawHappyPathWithRoyaltyAndOwner() (gas: 1543572)
[PASS] testWithdrawProceedsReceiverReverts() (gas: 502492)
[PASS] testWithdrawTwiceRevertsNoProceeds() (gas: 432446)
[PASS] testWithdrawZeroBalanceReverts() (gas: 24549)
[PASS] testWrongQuantityParameterPaths() (gas: 283590)
Suite result: ok. 223 passed; 0 failed; 0 skipped; finished in 73.47s (75.79s CPU time)

Ran 2 test suites in 73.47s (144.70s CPU time): 224 tests passed, 0 failed, 0 skipped (224 total tests)
| File                                    | % Lines          | % Statements      | % Branches       | % Funcs          |
|-----------------------------------------|------------------|-------------------|------------------|------------------|
| script/deployDiamond.s.sol              | 0.00% (0/68)     | 0.00% (0/84)      | 0.00% (0/2)      | 0.00% (0/1)      |
| src/IdeationMarketDiamond.sol           | 62.50% (10/16)   | 56.52% (13/23)    | 100.00% (1/1)    | 100.00% (2/2)    |
| src/facets/BuyerWhitelistFacet.sol      | 92.31% (36/39)   | 88.68% (47/53)    | 63.64% (7/11)    | 100.00% (3/3)    |
| src/facets/CollectionWhitelistFacet.sol | 95.92% (47/49)   | 96.61% (57/59)    | 87.50% (7/8)     | 100.00% (5/5)    |
| src/facets/DiamondCutFacet.sol          | 100.00% (2/2)    | 100.00% (2/2)     | 100.00% (0/0)    | 100.00% (1/1)    |
| src/facets/DiamondLoupeFacet.sol        | 87.50% (14/16)   | 86.36% (19/22)    | 100.00% (0/0)    | 80.00% (4/5)     |
| src/facets/GetterFacet.sol              | 92.86% (39/42)   | 92.59% (50/54)    | 100.00% (5/5)    | 91.67% (11/12)   |
| src/facets/IdeationMarketFacet.sol      | 92.83% (298/321) | 93.11% (365/392)  | 87.16% (95/109)  | 100.00% (13/13)  |
| src/facets/OwnershipFacet.sol           | 100.00% (9/9)    | 100.00% (11/11)   | 100.00% (1/1)    | 100.00% (3/3)    |
| src/libraries/LibAppStorage.sol         | 50.00% (1/2)     | 50.00% (1/2)      | 100.00% (0/0)    | 100.00% (1/1)    |
| src/libraries/LibDiamond.sol            | 89.58% (86/96)   | 90.65% (97/107)   | 20.51% (8/39)    | 100.00% (13/13)  |
| src/upgradeInitializers/DiamondInit.sol | 100.00% (8/8)    | 100.00% (10/10)   | 100.00% (0/0)    | 100.00% (1/1)    |
| test/IdeationMarketDiamondTest.t.sol    | 71.77% (178/248) | 71.38% (217/304)  | 25.88% (22/85)   | 68.84% (95/138)  |
| Total                                   | 79.48% (728/916) | 79.16% (889/1123) | 55.94% (146/261) | 76.77% (152/198) |
